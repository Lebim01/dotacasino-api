import * as crypto from 'crypto';

export const md5 =  (_0x174B4) => {
  var _0x16B6C = function (_0x176AC, _0x17784) {
    var _0x176F4, _0x177CC, _0x1773C, _0x17814, _0x17664;
    _0x1773C = _0x176AC & 2147483648;
    _0x17814 = _0x17784 & 2147483648;
    _0x176F4 = _0x176AC & 1073741824;
    _0x177CC = _0x17784 & 1073741824;
    _0x17664 = (_0x176AC & 1073741823) + (_0x17784 & 1073741823);
    if (_0x176F4 & _0x177CC) {
      return _0x17664 ^ 2147483648 ^ _0x1773C ^ _0x17814;
    }
    if (_0x176F4 | _0x177CC) {
      if (_0x17664 & 1073741824) {
        return _0x17664 ^ 3221225472 ^ _0x1773C ^ _0x17814;
      } else {
        return _0x17664 ^ 1073741824 ^ _0x1773C ^ _0x17814;
      }
    } else {
      return _0x17664 ^ _0x1773C ^ _0x17814;
    }
  };
  var _0x16DAC = function (
    _0x16ADC,
    _0x1677C,
    _0x16BFC,
    _0x16CD4,
    _0x1758C,
    _0x17934,
    _0x178EC
  ) {
    _0x16ADC = _0x16B6C(
      _0x16ADC,
      _0x16B6C(
        _0x16B6C((_0x1677C & _0x16BFC) | (~_0x1677C & _0x16CD4), _0x1758C),
        _0x178EC
      )
    );
    return _0x16B6C(
      (_0x16ADC << _0x17934) | (_0x16ADC >>> (32 - _0x17934)),
      _0x1677C
    );
  };
  var _0x16E3C = function (
    _0x16ADC,
    _0x1677C,
    _0x16BFC,
    _0x16CD4,
    _0x1758C,
    _0x17934,
    _0x178EC
  ) {
    _0x16ADC = _0x16B6C(
      _0x16ADC,
      _0x16B6C(
        _0x16B6C((_0x1677C & _0x16CD4) | (_0x16BFC & ~_0x16CD4), _0x1758C),
        _0x178EC
      )
    );
    return _0x16B6C(
      (_0x16ADC << _0x17934) | (_0x16ADC >>> (32 - _0x17934)),
      _0x1677C
    );
  };
  var _0x16ECC = function (
    _0x16ADC,
    _0x1677C,
    _0x16BFC,
    _0x16CD4,
    _0x1758C,
    _0x17934,
    _0x178EC
  ) {
    _0x16ADC = _0x16B6C(
      _0x16ADC,
      _0x16B6C(_0x16B6C(_0x1677C ^ _0x16BFC ^ _0x16CD4, _0x1758C), _0x178EC)
    );
    return _0x16B6C(
      (_0x16ADC << _0x17934) | (_0x16ADC >>> (32 - _0x17934)),
      _0x1677C
    );
  };
  var _0x16F5C = function (
    _0x16ADC,
    _0x1677C,
    _0x16BFC,
    _0x16CD4,
    _0x1758C,
    _0x17934,
    _0x178EC
  ) {
    _0x16ADC = _0x16B6C(
      _0x16ADC,
      _0x16B6C(_0x16B6C(_0x16BFC ^ (_0x1677C | ~_0x16CD4), _0x1758C), _0x178EC)
    );
    return _0x16B6C(
      (_0x16ADC << _0x17934) | (_0x16ADC >>> (32 - _0x17934)),
      _0x1677C
    );
  };
  var _0x16C8C = function (_0x174B4) {
    var _0x17B74;
    var _0x17A0C = _0x174B4.length;
    var _0x17A9C = _0x17A0C + 8;
    var _0x17AE4 = (_0x17A9C - (_0x17A9C % 64)) / 64;
    var _0x17A54 = (_0x17AE4 + 1) * 16;
    var _0x17B2C = Array(_0x17A54 - 1);
    var _0x179C4 = 0;
    var _0x1797C = 0;
    while (_0x1797C < _0x17A0C) {
      _0x17B74 = (_0x1797C - (_0x1797C % 4)) / 4;
      _0x179C4 = (_0x1797C % 4) * 8;
      _0x17B2C[_0x17B74] =
        _0x17B2C[_0x17B74] | (_0x174B4.charCodeAt(_0x1797C) << _0x179C4);
      _0x1797C++;
    }
    _0x17B74 = (_0x1797C - (_0x1797C % 4)) / 4;
    _0x179C4 = (_0x1797C % 4) * 8;
    _0x17B2C[_0x17B74] = _0x17B2C[_0x17B74] | (128 << _0x179C4);
    _0x17B2C[_0x17A54 - 2] = _0x17A0C << 3;
    _0x17B2C[_0x17A54 - 1] = _0x17A0C >>> 29;
    return _0x17B2C;
  };
  var _0x17544 = function (_0x1761C) {
    var _0x17C4C = "",
      _0x17C94 = "",
      _0x17BBC,
      _0x17C04;
    for (_0x17C04 = 0; _0x17C04 <= 3; _0x17C04++) {
      _0x17BBC = (_0x1761C >>> (_0x17C04 * 8)) & 255;
      _0x17C94 = "0" + _0x17BBC.toString(16);
      _0x17C4C = _0x17C4C + _0x17C94.substr(_0x17C94.length - 2, 2);
    }
    return _0x17C4C;
  };
  var _0x1758C = Array();
  var _0x16FA4,
    _0x16B24,
    _0x16BB4,
    _0x16C44,
    _0x16D1C,
    _0x16ADC,
    _0x1677C,
    _0x16BFC,
    _0x16CD4;
  var _0x17034 = 7,
    _0x1707C = 12,
    _0x170C4 = 17,
    _0x1710C = 22;
  var _0x17154 = 5,
    _0x1719C = 9,
    _0x171E4 = 14,
    _0x1722C = 20;
  var _0x17274 = 4,
    _0x172BC = 11,
    _0x17304 = 16,
    _0x1734C = 23;
  var _0x17394 = 6,
    _0x173DC = 10,
    _0x17424 = 15,
    _0x1746C = 21;
  _0x1758C = _0x16C8C(_0x174B4);
  _0x16ADC = 1732584193;
  _0x1677C = 4023233417;
  _0x16BFC = 2562383102;
  _0x16CD4 = 271733878;
  for (_0x16FA4 = 0; _0x16FA4 < _0x1758C.length; _0x16FA4 += 16) {
    _0x16B24 = _0x16ADC;
    _0x16BB4 = _0x1677C;
    _0x16C44 = _0x16BFC;
    _0x16D1C = _0x16CD4;
    _0x16ADC = _0x16DAC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 0],
      _0x17034,
      3614090360
    );
    _0x16CD4 = _0x16DAC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 1],
      _0x1707C,
      3905402710
    );
    _0x16BFC = _0x16DAC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 2],
      _0x170C4,
      606105819
    );
    _0x1677C = _0x16DAC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 3],
      _0x1710C,
      3250441966
    );
    _0x16ADC = _0x16DAC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 4],
      _0x17034,
      4118548399
    );
    _0x16CD4 = _0x16DAC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 5],
      _0x1707C,
      1200080426
    );
    _0x16BFC = _0x16DAC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 6],
      _0x170C4,
      2821735955
    );
    _0x1677C = _0x16DAC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 7],
      _0x1710C,
      4249261313
    );
    _0x16ADC = _0x16DAC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 8],
      _0x17034,
      1770035416
    );
    _0x16CD4 = _0x16DAC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 9],
      _0x1707C,
      2336552879
    );
    _0x16BFC = _0x16DAC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 10],
      _0x170C4,
      4294925233
    );
    _0x1677C = _0x16DAC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 11],
      _0x1710C,
      2304563134
    );
    _0x16ADC = _0x16DAC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 12],
      _0x17034,
      1804603682
    );
    _0x16CD4 = _0x16DAC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 13],
      _0x1707C,
      4254626195
    );
    _0x16BFC = _0x16DAC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 14],
      _0x170C4,
      2792965006
    );
    _0x1677C = _0x16DAC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 15],
      _0x1710C,
      1236535329
    );
    _0x16ADC = _0x16E3C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 1],
      _0x17154,
      4129170786
    );
    _0x16CD4 = _0x16E3C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 6],
      _0x1719C,
      3225465664
    );
    _0x16BFC = _0x16E3C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 11],
      _0x171E4,
      643717713
    );
    _0x1677C = _0x16E3C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 0],
      _0x1722C,
      3921069994
    );
    _0x16ADC = _0x16E3C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 5],
      _0x17154,
      3593408605
    );
    _0x16CD4 = _0x16E3C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 10],
      _0x1719C,
      38016083
    );
    _0x16BFC = _0x16E3C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 15],
      _0x171E4,
      3634488961
    );
    _0x1677C = _0x16E3C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 4],
      _0x1722C,
      3889429448
    );
    _0x16ADC = _0x16E3C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 9],
      _0x17154,
      568446438
    );
    _0x16CD4 = _0x16E3C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 14],
      _0x1719C,
      3275163606
    );
    _0x16BFC = _0x16E3C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 3],
      _0x171E4,
      4107603335
    );
    _0x1677C = _0x16E3C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 8],
      _0x1722C,
      1163531501
    );
    _0x16ADC = _0x16E3C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 13],
      _0x17154,
      2850285829
    );
    _0x16CD4 = _0x16E3C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 2],
      _0x1719C,
      4243563512
    );
    _0x16BFC = _0x16E3C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 7],
      _0x171E4,
      1735328473
    );
    _0x1677C = _0x16E3C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 12],
      _0x1722C,
      2368359562
    );
    _0x16ADC = _0x16ECC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 5],
      _0x17274,
      4294588738
    );
    _0x16CD4 = _0x16ECC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 8],
      _0x172BC,
      2272392833
    );
    _0x16BFC = _0x16ECC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 11],
      _0x17304,
      1839030562
    );
    _0x1677C = _0x16ECC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 14],
      _0x1734C,
      4259657740
    );
    _0x16ADC = _0x16ECC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 1],
      _0x17274,
      2763975236
    );
    _0x16CD4 = _0x16ECC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 4],
      _0x172BC,
      1272893353
    );
    _0x16BFC = _0x16ECC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 7],
      _0x17304,
      4139469664
    );
    _0x1677C = _0x16ECC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 10],
      _0x1734C,
      3200236656
    );
    _0x16ADC = _0x16ECC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 13],
      _0x17274,
      681279174
    );
    _0x16CD4 = _0x16ECC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 0],
      _0x172BC,
      3936430074
    );
    _0x16BFC = _0x16ECC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 3],
      _0x17304,
      3572445317
    );
    _0x1677C = _0x16ECC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 6],
      _0x1734C,
      76029189
    );
    _0x16ADC = _0x16ECC(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 9],
      _0x17274,
      3654602809
    );
    _0x16CD4 = _0x16ECC(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 12],
      _0x172BC,
      3873151461
    );
    _0x16BFC = _0x16ECC(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 15],
      _0x17304,
      530742520
    );
    _0x1677C = _0x16ECC(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 2],
      _0x1734C,
      3299628645
    );
    _0x16ADC = _0x16F5C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 0],
      _0x17394,
      4096336452
    );
    _0x16CD4 = _0x16F5C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 7],
      _0x173DC,
      1126891415
    );
    _0x16BFC = _0x16F5C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 14],
      _0x17424,
      2878612391
    );
    _0x1677C = _0x16F5C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 5],
      _0x1746C,
      4237533241
    );
    _0x16ADC = _0x16F5C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 12],
      _0x17394,
      1700485571
    );
    _0x16CD4 = _0x16F5C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 3],
      _0x173DC,
      2399980690
    );
    _0x16BFC = _0x16F5C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 10],
      _0x17424,
      4293915773
    );
    _0x1677C = _0x16F5C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 1],
      _0x1746C,
      2240044497
    );
    _0x16ADC = _0x16F5C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 8],
      _0x17394,
      1873313359
    );
    _0x16CD4 = _0x16F5C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 15],
      _0x173DC,
      4264355552
    );
    _0x16BFC = _0x16F5C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 6],
      _0x17424,
      2734768916
    );
    _0x1677C = _0x16F5C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 13],
      _0x1746C,
      1309151649
    );
    _0x16ADC = _0x16F5C(
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x1758C[_0x16FA4 + 4],
      _0x17394,
      4149444226
    );
    _0x16CD4 = _0x16F5C(
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x16BFC,
      _0x1758C[_0x16FA4 + 11],
      _0x173DC,
      3174756917
    );
    _0x16BFC = _0x16F5C(
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1677C,
      _0x1758C[_0x16FA4 + 2],
      _0x17424,
      718787259
    );
    _0x1677C = _0x16F5C(
      _0x1677C,
      _0x16BFC,
      _0x16CD4,
      _0x16ADC,
      _0x1758C[_0x16FA4 + 9],
      _0x1746C,
      3951481745
    );
    _0x16ADC = _0x16B6C(_0x16ADC, _0x16B24);
    _0x1677C = _0x16B6C(_0x1677C, _0x16BB4);
    _0x16BFC = _0x16B6C(_0x16BFC, _0x16C44);
    _0x16CD4 = _0x16B6C(_0x16CD4, _0x16D1C);
  }
  var _0x174FC =
    _0x17544(_0x16ADC) +
    _0x17544(_0x1677C) +
    _0x17544(_0x16BFC) +
    _0x17544(_0x16CD4);
  return _0x174FC.toLowerCase();
};

export const generateHmacResponse = (requestBody: any, secretKey: string): string => {
  const base = { ...requestBody };
  delete base.hmac;

  if ('actions' in base) {
    let actionsStr = '';
    for (const action of base.actions) {
      Object.keys(action)
        .sort()
        .forEach((key) => {
          actionsStr += action[key];
        });
    }
    base.actions = actionsStr;
  }

  const hash = crypto.createHash('sha256');
  const hmacKey = hash.update(secretKey).digest();
  const hmacInstance = crypto.createHmac('sha256', hmacKey);

  let hmacBase = '';
  Object.keys(base)
    .sort()
    .forEach((key) => {
      hmacBase += base[key];
    });

  return hmacInstance.update(hmacBase).digest('hex');
};
